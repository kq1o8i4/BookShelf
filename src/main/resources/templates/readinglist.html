<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>èª­ã‚“ã§ã„ã‚‹æœ¬ä¸€è¦§</title>
    <style>
        ul {
            padding-left: 0;
            list-style-type: none;
        }

        li {
            margin-bottom: 5px;
        }

        .mypage-link {
            font-size: 16px;
            margin-top: 20px;
            display: block;
            text-decoration: none;
            color: #000;
        }

        .book-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .book-info p {
            margin: 0;
        }

        .date-text {
            color: brown;
        }

        .sort-box {
            margin: 15px 0;
        }
    </style>
</head>

<body>
    <header style="background-color: #D2B48C;">
        <h2 style="color: yellow; padding-left: 20px;">èª­ã‚“ã§ã„ã‚‹æœ¬ä¸€è¦§</h2>
    </header>

    <div class="mypage-link">
        <a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>

    <form action="/readinglist" method="get">
        <label for="author">ä½œè€…ã§çµã‚Šè¾¼ã‚€: </label>
        <select name="author" id="author" onchange="this.form.submit()">
            <option value="">ã™ã¹ã¦</option>
            <option th:each="author : ${authors}" th:value="${author}" th:text="${author}" th:selected="${author == selectedAuthor}"></option>
        </select>

        <label for="titleKeyword">ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢: </label>
        <input type="text" id="titleKeyword" name="titleKeyword" th:value="${titleKeyword}" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" />
        <button type="submit">æ¤œç´¢</button>
    </form>

    <!-- ğŸ”½ ã‚½ãƒ¼ãƒˆé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="sort-box">
        <label for="sortSelect">ä¸¦ã³æ›¿ãˆï¼š</label>
        <select id="sortSelect" onchange="sortBooks()">
            <option value="">-- é¸æŠ --</option>
            <option value="date">èª­æ›¸é–‹å§‹æ—¥é †</option>
            <option value="author">ä½œè€…é †ï¼ˆ50éŸ³ï¼‰</option>
            <option value="title">ã‚¿ã‚¤ãƒˆãƒ«é †ï¼ˆ50éŸ³ï¼‰</option>
        </select>
    </div>

    <!-- ğŸ”½ ã‚½ãƒ¼ãƒˆå¯¾è±¡ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="bookList">
        <div th:each="entry : ${booksByAuthor}">
            <div th:each="book : ${entry.value}" class="book-card">
                <div class="book-info">
                    <p>
                        <strong>ã‚¿ã‚¤ãƒˆãƒ«ï¼š</strong>
                        <a th:href="@{'/edit/' + ${book.id}}" th:text="${book.title}"></a>
                    </p>
                    <p>
                        <strong>è‘—è€…ï¼š</strong>
                        <span th:text="${book.author}"></span>
                    </p>
                    <p th:if="${book.formattedStartDate != null}" class="date-text">
                        <strong>èª­æ›¸é–‹å§‹æ—¥ï¼š</strong>
                        <span th:text="${book.formattedStartDate}"></span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <footer style="background-color: #D2B48C;">
        <p>Â© 2025 BookShelf</p>
    </footer>

    <!-- ğŸ”½ ã‚½ãƒ¼ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        function sortBooks() {
            const sortBy = document.getElementById("sortSelect").value;
            const bookList = document.getElementById("bookList");
            const bookCards = Array.from(bookList.querySelectorAll(".book-card"));

            bookCards.sort((a, b) => {
                const getText = (el, selector) => el.querySelector(selector)?.textContent.trim() || "";

                if (sortBy === "date") {
                    const dateA = new Date(getText(a, ".date-text span"));
                    const dateB = new Date(getText(b, ".date-text span"));
                    return dateA - dateB;
                } else if (sortBy === "author") {
                    const authorA = getText(a, "p:nth-child(2) span");
                    const authorB = getText(b, "p:nth-child(2) span");
                    return authorA.localeCompare(authorB, 'ja');
                } else if (sortBy === "title") {
                    const titleA = getText(a, "p:nth-child(1) a");
                    const titleB = getText(b, "p:nth-child(1) a");
                    return titleA.localeCompare(titleB, 'ja');
                }
                return 0;
            });

            bookCards.forEach(card => bookList.appendChild(card));
        }
    </script>
</body>

</html>
