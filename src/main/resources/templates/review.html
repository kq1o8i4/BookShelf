<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§</title>
    <style>
        /* ãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š */
        ul {
            padding-left: 0;
            list-style-type: none;
        }

        li {
            margin-bottom: 5px;
        }

        /* ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .mypage-link {
            font-size: 16px;
            margin-top: 20px;
            display: block;
            text-decoration: none;
            color: #000;
        }

        /* å„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .review-item {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* ãƒ¬ãƒ“ãƒ¥ãƒ¼æ—¥ä»˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .review-date {
            color: brown;
        }

        /* ç™»éŒ²æ—¥ä»˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå°ã•ã„æ–‡å­—ã§ã‚°ãƒ¬ãƒ¼ï¼‰ */
        .registration-date {
            color: gray;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦ã€Œãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ã€ã‚’è¡¨ç¤º -->
    <header style="background-color: #D2B48C; text-align: center;">
        <h2 style="color: yellow; text-align: left; padding-left: 20px;">ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§</h2>
    </header>

    <!-- ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
    <div class="mypage-link">
        <a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>

    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆä½œè€…ã§çµã‚Šè¾¼ã‚€ã€ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢ï¼‰ -->
    <form action="/review" method="get">
        <!-- ä½œè€…ã§çµã‚Šè¾¼ã‚€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
        <label for="author">ä½œè€…ã§çµã‚Šè¾¼ã‚€: </label>
        <select name="author" id="author" onchange="this.form.submit()">
            <option value="">ã™ã¹ã¦</option>
            <option th:each="author : ${authors}" th:value="${author}" th:text="${author}" th:selected="${author == selectedAuthor}"></option>
        </select>

        <!-- ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
        <label for="titleKeyword">ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢: </label>
        <input type="text" id="titleKeyword" name="titleKeyword" th:value="${titleKeyword}" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" />
        <button type="submit">æ¤œç´¢</button>
    </form>

    <!-- ğŸ”½ ã‚½ãƒ¼ãƒˆé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼šä¸¦ã³æ›¿ãˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
    <div class="sort-box" style="margin-top: 15px;">
        <label for="sortSelect">ä¸¦ã³æ›¿ãˆï¼š</label>
        <select id="sortSelect" onchange="sortReviews()">
            <option value="">-- é¸æŠ --</option>
            <option value="date">èª­äº†æ—¥é †</option>
            <option value="author">ä½œè€…é †ï¼ˆ50éŸ³ï¼‰</option>
            <option value="title">ã‚¿ã‚¤ãƒˆãƒ«é †ï¼ˆ50éŸ³ï¼‰</option>
        </select>
    </div>

    <!-- ğŸ”½ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆ -->
    <ul id="reviewList">
        <!-- å„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ«ãƒ¼ãƒ—ã€‚Thymeleafã§å‹•çš„ã«å†…å®¹ã‚’è¡¨ç¤º -->
        <li th:each="book : ${readBooks}" class="review-item">
            <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ -->
            <span class="review-text" th:text="${book.review}"></span>

            <!-- æ›¸ç±ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒªãƒ³ã‚¯ã¨ã—ã¦è¡¨ç¤ºã€‚ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç·¨é›†ãƒšãƒ¼ã‚¸ã«é·ç§» -->
            <a th:href="@{/edit/{id}(id=${book.id})}" class="book-title" th:text="' / ' + ${book.title}"></a>

            <!-- æœ¬ã®è‘—è€…ã¨èª­äº†æ—¥ã‚’éš ã™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦ä¿æŒ -->
            <span class="book-author" style="display:none;" th:text="${book.author}"></span>
            <span class="review-date" style="display:none;" th:text="${book.formattedEndDate}"></span>

            <!-- èª­äº†æ—¥ã‚’è¡¨ç¤º -->
            <span class="review-date" th:text="${book.formattedEndDate}"></span>
        </li>
    </ul>

    <footer style="background-color: #D2B48C;">
        <p>2025 BookShelf</p>
    </footer>

    <!-- ğŸ”½ JavaScriptã«ã‚ˆã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã‚½ãƒ¼ãƒˆ -->
    <script>
        function sortReviews() {
            const sortBy = document.getElementById("sortSelect").value;
            const list = document.getElementById("reviewList");
            const items = Array.from(list.querySelectorAll("li.review-item"));

            // ã‚½ãƒ¼ãƒˆæ¡ä»¶ã«å¿œã˜ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆã‚’ä¸¦ã¹æ›¿ãˆã‚‹
            items.sort((a, b) => {
                const getText = (el, selector) => el.querySelector(selector)?.textContent.trim() || "";

                if (sortBy === "date") {
                    const dateA = new Date(getText(a, ".review-date"));
                    const dateB = new Date(getText(b, ".review-date"));
                    return dateA - dateB; // èª­äº†æ—¥é †ã«ã‚½ãƒ¼ãƒˆ
                } else if (sortBy === "author") {
                    const authorA = getText(a, ".book-author");
                    const authorB = getText(b, ".book-author");
                    return authorA.localeCompare(authorB, 'ja'); // ä½œè€…é †ã«ã‚½ãƒ¼ãƒˆï¼ˆ50éŸ³é †ï¼‰
                } else if (sortBy === "title") {
                    const titleA = getText(a, ".book-title");
                    const titleB = getText(b, ".book-title");
                    return titleA.localeCompare(titleB, 'ja'); // ã‚¿ã‚¤ãƒˆãƒ«é †ã«ã‚½ãƒ¼ãƒˆï¼ˆ50éŸ³é †ï¼‰
                }
                return 0; // ã‚½ãƒ¼ãƒˆæ¡ä»¶ãŒé¸ã°ã‚Œã¦ã„ãªã„å ´åˆã€ãã®ã¾ã¾
            });

            // ä¸¦ã³æ›¿ãˆãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒªã‚¹ãƒˆã«å†é…ç½®
            items.forEach(item => list.appendChild(item));
        }
    </script>
</body>

</html>
